---
title: "E-commerce 데이터 분석 (1)"
description: |
  UCI Machine Learning Repository: Online Retail Dataset
date: Sys.Date()
categories: [machine learning, statistics]
image: ecommerce.jpg
preview-links: true
---


```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set()
options(width=200)
```

```{css, echo=FALSE}
pre code, pre, code {
  <!-- white-space: pre !important; -->
  overflow-x: scroll !important;
  <!-- word-break: keep-all !important; -->
  <!-- word-wrap: initial !important; -->
}
```

본 포스팅은 패스트캠퍼스 [50개 프로젝트로 완벽하게 끝내는 머신러닝 시그니쳐](https://fastcampus.co.kr/data_online_msignature)의 강의내용을 바탕으로 참고하여 작성하였습니다.

![문제해결 프로세스 7단계](seven-step-problem-solving-process.png){#fig-1}

## 01. 문제해결 프로세스 기획{#sec-1}

패스트캠퍼스 강의 중 박지환 강사님께서 준비 해주신 이커머스 데이터 분석 예제를 참고하여 진행하였습니다. 주어진 문제의 시나리오는 아래와 같습니다.

:::{.callout-note icon=false}
### 시나리오

A사는 이커머스 플랫폼을 운영하고 있다. 해당 이커머스 플랫폼 서비스가 성장하기 위해서는 3가지 조건이 필요하다.

① 신규고객 유입 ② 유입 고객 재구매 ③ 재구매고객 충성 고객화


A사는 현재 '① 신규교객 유입 활동'은 마케팅 비용을 투자하여 적극 수행하고 있으나, '② 유입 고객 재구매'이 미미한 상황이다.
충성고객의 Spending Power는 전체 매출에서 많은 비중을 차지하고 있으므로, 충성고객의 성장이 이어지지 않으면 플랫폼의 성장도 멈추게 되버린다.

따라서 '② 유입 고객 재구매'를 촉진시킬 방법을 고민 중에 있는 상황이다.
:::

이 시나리오를 기반으로 문제해결 프로세스 @fig-1 에 따라 7가지 단계를 아래와 같이 정의할 수 있습니다. 

:::{.callout-note icon=false}
### 문제해결 프로세스

#### Step 1. 문제정의

* 문제현상: 신규 고객 유입 후 재구매로 이어지는 고객의 감소
* 예상 피해: `(재구매고객 → 충성고객)`의 부진으로 매출 성장 정체 및 신규고객 유입을 위한 마케팅 비용 증가로 인한 영업이익 감소

#### Step 2. 기대효과 

* 재구매 고객 증가 → 충성 고객 증가 → 매출 성장 → 영업 이익 증가
* 선순환 체계 구축으로 인한 서비스 성장

#### Step 3. 해결방안

* ① EDA 및 일회성 데이터 분석을 통해 재구매 고객의 특성을 분석하고 이를 토대로 마케팅 기획
* ② 재구매 가능성이 높은 고객을 예측하는 모델링 후 이를 활용한 타겟 마케팅 진행

#### Step 4. 우선순위

* ①번을 빠르게 수행 후 파일럿 테스트 진행 및 성과 측정
* ①번의 효과가 좋지 않다면, ②번 진행 후 파일럿 테스트  재실행

#### Step 5. 데이터 분석

* 결정된 우선순위에 따라서 데이터 분석 및 모델링 진행

#### Step 6. 성과측정

* 최종 마케팅 후 성능을 평가하기 위한 지표 수립
* 분석 및 모델링을 통해 추출한 타겟 고객군과 대조군을 설정하여 A/B 테스트 수행
* A/B 테스트 결과 마케팅(재구매) 반응률 비교를 통해 통계적으로 유의미한지 검증: `t-test`
* 유의미한 결과를 얻을 때까지 파일럿 테스트를 수정하며 진행

#### Step 7. 모델 운영

* 파일럿 테스트 후 결과가 유의미하다면 정규 마케팅으로 운영하기 위한 작업 준비
* 모델을 실행을 위한 주기와 추출 타겟 고객군의 범위 결정
* 정해진 주기에 따라 타겟 고객군의 추출을 자동화
* 이를 마케팅 시스템과 연계하여 타겟 마케팅을 주기적으로 운영 및 평가
:::

현재 Step 1~4의 단계가 완료되어 **데이터 분석을 수행**해야 하는 단계라고 간주하겠습니다. 

## 02. Data Readiness Check & Sampling

사용하고자 하는 데이터는 [UCI Machine Learning Repository](https://archive.ics.uci.edu/)에서 제공하는 [Online Retail](https://archive.ics.uci.edu/datasets?search=Online+Retail) 데이터를 사용해 진행했습니다. 

이 Online Retail 데이터를 A사에서 수집한 고객 거래 이력 데이터로 간주하고 해당 데이터에 대한 기본적인 전처리를 수행하겠습니다.

### 02-01. Data Info Check

주어진 데이터는 e-commerce 온라인 구매 데이터로 데이터 명세표는 아래와 같습니다.

|`InvoiceNo`|`StockCode`|`Description`|`Quantity`|`InvoiceDate`|`UnitPrice`|`CustomerID`|`Country`|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|송장번호|재고코드|상세설명|수량|송장날짜|개당가격|고객ID|국가|
|Categorical|Categorical|Categorical|Integer|Date|Continuous|Categorical|Categorical|

이제 수집된 데이터의 기본적인 정보를 확인해 보겠습니다.


```{r}
#| message: false
library(tidyverse)
df <- read_csv("Online Retail.csv", col_types = "ccciTdcc")
df %>% head()
```
#### **Data 크기 확인**

```{r}
# 1,067,370 rows & 8 cols
df %>% dim()
```

#### **Data type 확인**

```{r}
df %>% glimpse()
```

#### **변수별 결측치 확인**

```{r}
df %>% is.na() %>% colSums()
```

고객 식별 정보인 `CustomerID` 같은 변수에 결측치가 있는 경우에는 추후에 해당 고객에 대한 정보를 알 수 없으므로 사전에 정보를 알 수 없는 불분명한 데이터로 취급하여 삭제하는 것이 좋습니다.

```{r}
df <- df %>% drop_na("CustomerID")
df %>% is.na() %>% colSums()
```

#### **Outlier 확인**

```{r}
df %>% 
  select_if(is.numeric) %>% 
  summary()
```

구매 수량을 나타내는 `Quantity`는 음수 값을 가질 수 없으나, 반품 물품에 대한 값이 있으므로 확인 후 처리해야 합니다. 여기서는 `Quantity`가 음수인 값은 이상치(Outlier)라고 간주하고 삭제하겠습니다.

```{r}
# Quantity가 음수인 데이터 확인 
# 반품 및 회수 물량일 수도 있음
df %>% filter(Quantity < 0)
```
```{r}
# Quantity 음수값 제거
df <- df %>% filter(Quantity > 0)
```

